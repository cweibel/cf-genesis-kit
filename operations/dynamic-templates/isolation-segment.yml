--- # cleanup-params-passed
iso_group: (( prune ))
--- # replace-instance-groups
type: replace
path: /instance_groups/-
value:
  name: (( grab iso_group.name ))
  azs: (( grab iso_group.azs ))
  instances: (( grab iso_group.instances || 1 ))
  vm_type: (( grab iso_group.vm_type || minimal ))
  vm_extensions: (( grab iso_group.vm_extensions))
  stemcell: (( grab iso_group.stemcell || default ))
  networks:
  - name: (( grab iso_group.network_name || default ))
  jobs:
  - name: rep
    release: diego
    properties:
      bpm:
        enabled: true
      diego:
        executor:
          instance_identity_ca_cert: ((diego_instance_identity_ca.certificate))
          instance_identity_key: ((diego_instance_identity_ca.private_key))
        rep:
          preloaded_rootfses:
          - cflinuxfs3:/var/vcap/packages/cflinuxfs3/rootfs.tar
          placement_tags:
          - (( grab iso_group.name ))


--- # bosh-dns-aliases
addons:
- jobs:
  - name: bosh-dns-aliases
    properties:
      aliases:
      - domain: _.cell.service.cf.internal
        targets:
        - ((append))
        - deployment: ((deployment_name))
          domain: bosh
          instance_group: (( grab iso_group.name ))
          network: (( grab iso_group.network_name || default))
          query: _
